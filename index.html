<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Blackjack</title>
<style>
  body {
    background: #0b3d0b;
    font-family: Arial, sans-serif;
    color: white;
    text-align: center;
  }
  #table {
    margin: 20px auto;
    padding: 20px;
    width: 900px;
    border-radius: 20px;
    background: #145214;
    box-shadow: 0 0 20px #000;
  }
  .hand {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }
  .card-img {
    width: 80px;
    height: 120px;
    margin: 5px;
  }

  /* CASINO CHIP STYLE */
  .chip {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    border: 6px solid rgba(255,255,255,0.85);
    margin: 10px;
    cursor: pointer;
    transition: transform 0.2s;
  }
  .chip:active {
    transform: scale(0.9);
  }
  .value1 { background: white; color: black; }
  .value5 { background: red; }
  .value25 { background: green; }
  .value50 { background: blue; }
  .value100 { background: black; }
  .value500 { background: purple; }

  button {
    padding: 10px 20px;
    font-size: 16px;
    margin: 5px;
    cursor: pointer;
    border-radius: 8px;
  }
</style>
</head>
<body>
<div id="table">
  <h1>Blackjack</h1>

  <h2>Dealer</h2>
  <div id="dealer-hand" class="hand"></div>

  <h2>You</h2>
  <div id="player-hand" class="hand"></div>

  <h2 id="message"></h2>

  <p id="balance-display">Balance: $1000</p>
  <p id="bet-display">Current Bet: $0</p>

  <div id="chips"></div>

  <button id="deal-btn">Deal</button>
  <button id="hit-btn">Hit</button>
  <button id="stand-btn">Stand</button>
  <button id="reset-btn">Reset Game</button>
</div>

<script>
let balance = 1000;
let bet = 0;
let deck = [];
let player = [];
let dealer = [];
let inRound = false;

const dealerEl = document.getElementById("dealer-hand");
const playerEl = document.getElementById("player-hand");
const messageEl = document.getElementById("message");
const balanceEl = document.getElementById("balance-display");
const betEl = document.getElementById("bet-display");

function buildDeck() {
  const suits = ["C", "D", "H", "S"]; // clubs diamonds hearts spades
  const ranks = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
  deck = [];
  for (let s of suits) {
    for (let r of ranks) deck.push(r + s);
  }
  deck.sort(() => Math.random() - 0.5);
}

function cardValue(card) {
  const r = card.slice(0, -1);
  if (r === "A") return 11;
  if (["K", "Q", "J"].includes(r)) return 10;
  return parseInt(r);
}

function handValue(hand) {
  let total = 0;
  let aces = 0;
  for (let c of hand) {
    let v = cardValue(c);
    total += v;
    if (c[0] === "A") aces++;
  }
  while (total > 21 && aces > 0) {
    total -= 10;
    aces--;
  }
  return total;
}

function renderHand(el, hand, hideFirst = false) {
  el.innerHTML = '';
  hand.forEach((card, index) => {
    const img = document.createElement('img');
    img.className = 'card-img';
    if (hideFirst && index === 0) img.src = 'https://deckofcardsapi.com/static/img/back.png';
    else img.src = `https://deckofcardsapi.com/static/img/${card}.png`;
    el.appendChild(img);
  });
}

function render() {
  renderHand(dealerEl, dealer, inRound);
  renderHand(playerEl, player, false);
  balanceEl.textContent = `Balance: $${balance}`;
  betEl.textContent = `Current Bet: $${bet}`;
}

function draw() {
  return deck.pop();
}

async function dealerPlay() {
  while (handValue(dealer) < 17) {
    const dealerTotal = handValue(dealer);
    const playerTotal = handValue(player);

    // Special delay rule
    if (dealerTotal >= playerTotal - 10 && (dealerTotal >= 12 && playerTotal <= 16)) {
      await new Promise(r => setTimeout(r, 5000));
    } else {
      await new Promise(r => setTimeout(r, 2000));
    }

    dealer.push(draw());
    render();
  }
}

async function endRound(playerBust = false) {
  await dealerPlay();
  const p = handValue(player);
  const d = handValue(dealer);
  let msg = '';

  if (playerBust) {
    msg = `Bust! You lose $${bet}`;
    balance -= bet;
  } else if (d > 21 || p > d) {
    msg = `You win $${bet}`;
    balance += bet;
  } else if (p === d) {
    msg = 'Push â€” Bet returned';
  } else {
    msg = `You lose $${bet}`;
    balance -= bet;
  }

  inRound = false;
  bet = 0;
  messageEl.textContent = msg;
  render();
}

function deal() {
  if (bet === 0 || inRound) return;
  inRound = true;
  messageEl.textContent = '';

  buildDeck();
  player = [draw(), draw()];
  dealer = [draw(), draw()];
  render();

  if (handValue(player) === 21) endRound(false);
}

function hit() {
  if (!inRound) return;
  player.push(draw());
  render();
  if (handValue(player) > 21) endRound(true);
}

function stand() {
  if (!inRound) return;
  endRound(false);
}

function resetGame() {
  balance = 1000;
  bet = 0;
  player = [];
  dealer = [];
  inRound = false;
  messageEl.textContent = '';
  render();
}

// CHIP SYSTEM
const chipValues = [1, 5, 25, 50, 100, 500];

function buildChips() {
  const div = document.getElementById("chips");
  div.innerHTML = '';
  chipValues.forEach(v => {
    const chip = document.createElement('div');
    chip.className = `chip value${v}`;
    chip.textContent = `$${v}`;
    chip.addEventListener('click', () => {
      if (!inRound && balance >= v) bet += v;
      render();
    });
    div.appendChild(chip);
  });
}

// Button events
document.getElementById("deal-btn").onclick = deal;
document.getElementById("hit-btn").onclick = hit;
document.getElementById("stand-btn").onclick = stand;
document.getElementById("reset-btn").onclick = resetGame;

buildChips();
render();
</script>
</body>
</html>
